var btdsgn="undefined"!=typeof btdsgn?btdsgn:{};btdsgn.getParameterByName=function(e,a){"use strict";a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i"),o=n.exec(a);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null};var ApoFinder="undefined"!=typeof ApoFinder?ApoFinder:function(){"use strict";function e(){null!==w&&(w.setOptions({scrollwheel:!0}),$("#map-canvas").addClass("map-focus"))}function a(){null!==w&&(w.setOptions({scrollwheel:!1}),$("#map-canvas").removeClass("map-focus"))}function n(e){var a=new google.maps.LatLngBounds,n=100;d.length>0&&d.forEach(function(e){void 0!==c[e]&&c[e].setMap(null)}),d=[],c=[],google.maps.Map.prototype.markers=c,$("#addresses").html(""),e.forEach(function(e){$("#addresses").append('<div id="place_'+e.place_id+'" class="col-sm-6 col-md-4"></div>'),d.push(e.place_id),b.getDetails(e,function(o,s){return"OK"!=s||null===o?void(void 0!==d[e.place_id]&&delete d[e.place_id]):o.types.indexOf("store")>-1?(window.setTimeout(function(){var n,s,t,r,u;r=o.opening_hours&&o.opening_hours.open_now===!0?h:f,u=o.opening_hours&&o.opening_hours.open_now===!0?v:_,n=new google.maps.Marker({map:w,icon:r,animation:google.maps.Animation.DROP,position:e.geometry.location,place_id:e.place_id}),c[e.place_id]=n,google.maps.event.addListener(n,"mouseover",function(){this.setIcon(u),$("#place_"+this.place_id).find(".panel").addClass("hovered")}),google.maps.event.addListener(n,"mouseout",function(){this.setIcon(r),$("#place_"+this.place_id).find(".panel").removeClass("hovered")}),google.maps.event.addListener(n,"click",function(){l&&l.close(),l=new google.maps.InfoWindow,t="",o.opening_hours&&o.opening_hours.open_now===!0&&(t+='<p class="pull-right"><span class="label label-success">&nbsp;<i class="fa fa-check-square-o"></i>&nbsp;geöffnet</span></p>'),t+='<p class="pharmacy-title"><strong>'+o.name+"</strong></p>",void 0!==o.adr_address&&(t+="<p>"+o.adr_address.replace(/,( )*/gi,"<br>")+'</p><p class="ellipsis">'),void 0!==o.website&&(t+='<a href="'+o.website+'" data-rel="external" target="_blank"><span class="fa fa-external-link-square"></span>&nbsp; '+o.website.replace(/http:/gi,"").replace(/\/\//gi,"").replace(/www\./gi,"").substr(0,30)+"&hellip;</a>"),void 0!==o.international_phone_number?t+='<br><a href="tel:'+o.international_phone_number+'"><span class="fa fa-phone-square"></span>&nbsp; '+o.international_phone_number+"</a>":void 0!==o.formatted_phone_number&&(t+='<br><a href="tel:'+o.formatted_phone_number+'"><span class="fa fa-phone-square"></span>&nbsp; '+o.formatted_phone_number+"</a>"),void 0!==o.url&&(t+='<br><a href="'+o.url+'" data-rel="external" target="_blank"><i class="fa fa-map"></i>&nbsp;Route planen</a>'),t+="</p>",l.setContent(t),l.open(w,this)}),s='<div class="panel panel-default panel-apotheke"><div class="panel-body">',o.opening_hours&&o.opening_hours.open_now===!0&&(s+='<p class="pull-right"><span class="label label-success">&nbsp;<i class="fa fa-check-square-o"></i>&nbsp;geöffnet</span></p>'),s+='<p class="pharmacy-title"><strong>'+o.name+"</strong></p>",void 0!==o.adr_address&&(s+="<p><small>"+o.adr_address.replace(/,( )*/gi,"<br>")+"</small></p>"),s+='<p class="ellipsis">',void 0!==o.international_phone_number?s+='<small><a href="tel:'+o.international_phone_number+'"><span class="fa fa-phone-square"></span>&nbsp; '+o.international_phone_number+"</a></small><br>":void 0!==o.formatted_phone_number&&(s+='<small><a href="tel:'+o.formatted_phone_number+'"><span class="fa fa-phone-square"></span>&nbsp; '+o.formatted_phone_number+"</a></small><br>"),void 0!==o.website&&(s+='<small><a href="'+o.website+'" data-rel="external" target="_blank"><span class="fa fa-external-link-square"></span>&nbsp; '+o.website+"</a></small><br>"),void 0!==o.url&&(s+='<small><a href="'+o.url+'" data-rel="external" target="_blank"><i class="fa fa-map"></i>&nbsp;Route planen</a></small><br>'),s+="</p></div></div>",$("#place_"+e.place_id).append(s).removeClass("hide"),$("#addresses").equalize({equalize:"innerHeight",children:".panel-body",reset:!0}),$("#place_"+e.place_id).on("click",function(){google.maps.event.trigger(c[e.place_id],"click")}),$("#place_"+e.place_id).on("mouseover",function(){google.maps.event.trigger(c[e.place_id],"mouseover")}),$("#place_"+e.place_id).on("mouseout",function(){google.maps.event.trigger(c[e.place_id],"mouseout")}),a.extend(e.geometry.location),p&&w.fitBounds(a),i=w.getZoom(),i>16&&d.length<4&&w.setZoom(15)},n),void(n+=150)):(void 0!==d[e.place_id]&&delete d[e.place_id],void $("#place_"+e.place_id).remove())})})}function o(e,a){a==google.maps.places.PlacesServiceStatus.OK?p&&n(e):$("#result").prepend('<div class="alert alert-warning" role="alert"><i class="fa fa-exclamation-triangle"></i> Zu Ihrer Suche konnten keine Apotheken gefunden werden. Versuchen Sie bitte einen anderen Ortsnamen oder eine benachbarte Postleitzahl.</div>')}function s(e){window.console.warn("ERROR("+e.code+"): "+e.message)}function t(a,n){var s=$(window).innerHeight()-200;s>500&&(s=500),$("#map-canvas").height(s);var t,r,l,p,c;n!==!0?(r=a.coords.latitude,l=a.coords.longitude,t=new google.maps.LatLng(r,l),c=new google.maps.Geocoder,c.geocode({location:t},function(e,a){a===google.maps.GeocoderStatus.OK&&e[1]&&$("#searchterm").val(e[1].formatted_address)})):t=a,null===w?(w=new google.maps.Map(document.getElementById("map-canvas"),{center:t,zoom:i,scrollwheel:!1}),google.maps.event.addListener(w,"mousedown",function(){e()}),b=new google.maps.places.PlacesService(w)):(w.panTo(t),w.setZoom(i)),p={location:t,rankBy:google.maps.places.RankBy.DISTANCE,types:["pharmacy"]},b.nearbySearch(p,o),$(".fa-spinner.fa-pulse.fa-fw").addClass("fa-crosshairs").removeClass("fa-spinner fa-pulse fa-fw")}function r(){if(!$('#map-canvas').length) return false;$(".alert-warning").remove();var e,a,n,o,r;p=!0,r={country:"DE"},navigator.geolocation&&$("#geoloc").removeClass("hide"),e=$("#searchterm").val(),""===e&&(e=btdsgn.getParameterByName("searchterm")),null!==e&&""!==e&&void 0!==e?($("#searchterm").val(m(e)),parseInt(e,10)>0&&(e=e.toString()),n=new google.maps.Geocoder,n.geocode({address:e,componentRestrictions:r},function(e,n){n==google.maps.GeocoderStatus.OK?a=new google.maps.LatLng(e[0].geometry.location.lat(),e[0].geometry.location.lng()):($("#result").prepend('<div class="alert alert-warning" role="alert"><i class="fa fa-exclamation-triangle"></i> Leider konnte kein passender Ort gefunden werden. Versuchen Sie bitte einen anderen Ortsnamen oder eine benachbarte Postleitzahl.</div>'),a=new google.maps.LatLng(51.4894837,10.7793493),i=6,p=!1),t(a,!0)}),$("#searchform.pharmacyform").velocity("scroll",{offset:-10})):(u=0===u?btdsgn.getParameterByName("geolocate"):u,1==u?(o={timeout:7e3},navigator.geolocation.getCurrentPosition(t,s,o),$("#searchform.pharmacyform").velocity("scroll",{offset:-10})):(a=new google.maps.LatLng(51.4894837,10.7793493),i=6,p=!1,t(a,!0)))}var l,i=15,p=!0,c=[],d=[],u=0,g=!1,m=function(e){return decodeURIComponent((e+"").replace(/%(?![\da-f]{2})/gi,function(){return"%25"}).replace(/\+/," "))},f="/static_resources/images/app/ic_place.png",h="/static_resources/images/app/ic_place-open.png",_="/static_resources/images/app/ic_place-hi.png",v="/static_resources/images/app/ic_place-hi-open.png",b=null,w=null;return $(document).on("click","#geoloc",function(e){e.preventDefault(),$(this).find("i.fa").removeClass("fa-crosshairs").addClass("fa-spinner fa-pulse fa-fw"),u=1,$("#searchterm").val(""),r()}),$(document).on("submit","#addressform",function(e){e.preventDefault(),e.stopPropagation(),g===!1&&($(".fa-crosshairs").removeClass("fa-crosshairs").addClass("fa-spinner fa-pulse fa-fw"),u=0,r())}),$(document).ready(function(){var e=new google.maps.places.Autocomplete(document.getElementById("searchterm"),{types:["geocode"],componentRestrictions:{country:"DE"}});e.addListener("place_changed",function(){g=!0,$(".fa-crosshairs").removeClass("fa-crosshairs").addClass("fa-spinner fa-pulse fa-fw"),u=0,r(),setTimeout(function(){g=!1},3e3)}),$("body").on("mousedown",function(e){var n=$(e.target).parents("#map-canvas").length>0;n||a()}),$(window).scroll(function(){a()})}),{init:r}}();$(document).ready(function(){"use strict";if($('#map-canvas').length){ApoFinder.init()}});